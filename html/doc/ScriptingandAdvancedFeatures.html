<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4. Scripting and Advanced Features &mdash; MOSAIC 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/rtd.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="MOSAIC 1.0 documentation" href="../index.html" />
    <link rel="next" title="5. Settings File" href="settingsFile.html" />
    <link rel="prev" title="3. MOSAIC GUI" href="GraphicalInterface.html" />
 
<link href='//fonts.googleapis.com/css?family=Roboto:100,300,100italic,300italic' rel='stylesheet' type='text/css'>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="settingsFile.html" title="5. Settings File"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="GraphicalInterface.html" title="3. MOSAIC GUI"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">MOSAIC 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="scripting-and-advanced-features">
<span id="scripting-page"></span><h1>4. Scripting and Advanced Features<a class="headerlink" href="#scripting-and-advanced-features" title="Permalink to this headline">¶</a></h1>
<p>The analysis can be run from the command line by setting up a <a class="reference external" href="http://www.python.org/">Python</a> script. Scripting allows one to build additional analysis tools on top of <em>MOSAIC</em>. The first step is to import the relevant modules, which can be accomplished with the import command. All the relevant modules required to run an analysis are contained within the top level <em>MOSAIC</em> module.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">mosaic.qdfTrajIO</span> <span class="kn">as</span> <span class="nn">qdf</span>
<span class="kn">import</span> <span class="nn">mosaic.abfTrajIO</span> <span class="kn">as</span> <span class="nn">abf</span>

<span class="kn">import</span> <span class="nn">mosaic.SingleChannelAnalysis</span>
<span class="kn">import</span> <span class="nn">mosaic.eventSegment</span> <span class="kn">as</span> <span class="nn">es</span>
<span class="kn">import</span> <span class="nn">mosaic.stepResponseAnalysis</span> <span class="kn">as</span> <span class="nn">sra</span>
<span class="kn">import</span> <span class="nn">mosaic.besselLowpassFilter</span> <span class="kn">as</span> <span class="nn">bessel</span>
</pre></div>
</div>
<div class="section" id="import-data-and-run-an-analysis">
<h2>4.1. Import Data and Run an Analysis<a class="headerlink" href="#import-data-and-run-an-analysis" title="Permalink to this headline">¶</a></h2>
<p>Once the required modules are imported, a basic analysis can be run with the code snippet below. The top-level object that is used to configure and run a new analysis is <a class="reference internal" href="../api-doc/mosaic.html#mosaic.SingleChannelAnalysis.SingleChannelAnalysis" title="mosaic.SingleChannelAnalysis.SingleChannelAnalysis"><tt class="xref py py-class docutils literal"><span class="pre">SingleChannelAnalysis</span></tt></a>, which takes five arguments: i) the path to the data directory, ii) a handle to a <em>TrajIO</em> object that reads in data (e.g. <a class="reference internal" href="../api-doc/mosaic.traj.html#mosaic.abfTrajIO.abfTrajIO" title="mosaic.abfTrajIO.abfTrajIO"><tt class="xref py py-class docutils literal"><span class="pre">abfTrajIO</span></tt></a>), iii) a handle to a data filtering algorithm (e.g. <a class="reference internal" href="../api-doc/mosaic.filter.html#mosaic.besselLowpassFilter.besselLowpassFilter" title="mosaic.besselLowpassFilter.besselLowpassFilter"><tt class="xref py py-class docutils literal"><span class="pre">besselLowpassFilter</span></tt></a> or <cite>None</cite> for no filtering), iv) a handle to a partitioning algorithm (e.g. <a class="reference internal" href="eventSegment.html#mosaic.eventSegment.eventSegment" title="mosaic.eventSegment.eventSegment"><tt class="xref py py-class docutils literal"><span class="pre">eventSegment</span></tt></a>) that partitions the data and v) a handle to a processing algorithm (e.g. <a class="reference internal" href="stepResponse.html#mosaic.stepResponseAnalysis.stepResponseAnalysis" title="mosaic.stepResponseAnalysis.stepResponseAnalysis"><tt class="xref py py-class docutils literal"><span class="pre">stepResponseAnalysis</span></tt></a>) that processes individual blockade events.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Process all ABF files in a directory</span>
<span class="n">mosaic</span><span class="o">.</span><span class="n">SingleChannelAnalysis</span><span class="o">.</span><span class="n">SingleChannelAnalysis</span><span class="p">(</span>
            <span class="s">&#39;~/ReferenceData/abfSet1&#39;</span><span class="p">,</span>
            <span class="n">abf</span><span class="o">.</span><span class="n">abfTrajIO</span><span class="p">,</span>
            <span class="bp">None</span><span class="p">,</span>
            <span class="n">es</span><span class="o">.</span><span class="n">eventSegment</span><span class="p">,</span>
            <span class="n">sra</span><span class="o">.</span><span class="n">stepResponseAnalysis</span>
        <span class="p">)</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>
</pre></div>
</div>
<p>The code listing above analyzes all ABF files in the specified directory. Handles to trajectory I/O, data filtering, event partitioning and event processing are controlled with their corresponding sections in the <a class="reference internal" href="settingsFile.html#settings-page"><em>Settings File</em></a>. Default settings used to read ABF files are shown below.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="s2">&quot;abfTrajIO&quot;</span> <span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;filter&quot;</span>            <span class="o">:</span> <span class="s2">&quot;*.abf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;start&quot;</span>             <span class="o">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s2">&quot;dcOffset&quot;</span>          <span class="o">:</span> <span class="mf">0.0</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>MOSAIC</em> also supports the QUB QDF file format used by the <a class="reference external" href="http://electronicbio.com">Electronic Biosciences</a> Nanopatch system. This is accomplished by replacing <a class="reference internal" href="../api-doc/mosaic.traj.html#mosaic.abfTrajIO.abfTrajIO" title="mosaic.abfTrajIO.abfTrajIO"><tt class="xref py py-class docutils literal"><span class="pre">abfTrajIO</span></tt></a> in the previous example with <a class="reference internal" href="../api-doc/mosaic.traj.html#mosaic.qdfTrajIO.qdfTrajIO" title="mosaic.qdfTrajIO.qdfTrajIO"><tt class="xref py py-class docutils literal"><span class="pre">qdfTrajIO</span></tt></a>.  Settings for QDF files require two additional parameters, the feedback resistance (Rfb) in Ohms and capacitance (Cfb) in Farads as described in the <a class="reference internal" href="apidocs.html#api-docs-page"><em>API Documentation</em></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Process all QDF files in a directory</span>
<span class="n">mosaic</span><span class="o">.</span><span class="n">SingleChannelAnalysis</span><span class="o">.</span><span class="n">SingleChannelAnalysis</span><span class="p">(</span>
            <span class="s">&#39;~/ReferenceData/qdfSet1&#39;</span><span class="p">,</span>
            <span class="n">qdf</span><span class="o">.</span><span class="n">qdfTrajIO</span><span class="p">,</span>
            <span class="bp">None</span><span class="p">,</span>
            <span class="n">es</span><span class="o">.</span><span class="n">eventSegment</span><span class="p">,</span>
            <span class="n">sra</span><span class="o">.</span><span class="n">stepResponseAnalysis</span>
        <span class="p">)</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>
</pre></div>
</div>
<p>Upon completion the analysis writes a log file to the directory containing the data. The log file summarizes the conditions under which the analysis were run, the settings used and timing information.</p>
<div class="highlight-python"><div class="highlight"><pre>Start time: 2014-10-05 11:53 AM

[Status]
    Segment trajectory: ***USER STOP***
    Process events: ***NORMAL***


[Summary]
    Baseline open channel conductance:
        Mean    = 136.0 pA
        SD  = 5.5 pA
        Slope   = 0.0 pA/s

    Event segment stats:
        Events detected = 11306

        Open channel drift (max) = 0.0 * SD
        Open channel drift rate (min/max) = (-2.77/3.0) pA/s


[Settings]
    Trajectory I/O settings:
        Files processed = 27
        Data path = ~/ReferenceData/qdfSet1
        File format = qdf
        Sampling frequency = 500.0 kHz

        Feedback resistance = 9.1 GOhm
        Feedback capacitance = 1.07 pF

    Event segment settings:
        Window size for block operations = 0.5 s
        Event padding = 50 points
        Min. event rejection length = 5 points
        Event trigger threshold = 2.36363636364 * SD

        Drift error threshold = 999.0 * SD
        Drift rate error threshold = 999.0 pA/s


    Event processing settings:
        Algorithm = stepResponseAnalysis

        Max. iterations  = 50000
        Fit tolerance (rel. err in leastsq)  = 1e-07
        Blockade Depth Rejection = 0.9



[Output]
    Output path = ~/ReferenceData/qdfSet1
    Event characterization data = ~/ReferenceData/qdfSet1/eventMD-20141005-115324.sqlite
    Event time-series = ***enabled***
    Log file = eventProcessing.log

[Timing]
    Segment trajectory = 98.03 s
    Process events = 0.0 s

    Total = 98.03 s
    Time per event = 8.67 ms
</pre></div>
</div>
<div class="section" id="filter-data">
<span id="scripting-filter-sec"></span><h3>4.1.1. Filter Data<a class="headerlink" href="#filter-data" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Filter data with a Bessel filter before processing</span>
<span class="n">mosaic</span><span class="o">.</span><span class="n">SingleChannelAnalysis</span><span class="o">.</span><span class="n">SingleChannelAnalysis</span><span class="p">(</span>
            <span class="s">&#39;~/ReferenceData/abfSet1&#39;</span><span class="p">,</span>
            <span class="n">abf</span><span class="o">.</span><span class="n">abfTrajIO</span><span class="p">,</span>
            <span class="n">bessel</span><span class="o">.</span><span class="n">besselLowpassFilter</span><span class="p">,</span>
            <span class="n">es</span><span class="o">.</span><span class="n">eventSegment</span><span class="p">,</span>
            <span class="n">sra</span><span class="o">.</span><span class="n">stepResponseAnalysis</span>
        <span class="p">)</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>
</pre></div>
</div>
<p><em>MOSAIC</em> supports filtering data prior to analysis. This is achieved by passing the <cite>dataFilterHnd</cite> argument to the <a class="reference internal" href="../api-doc/mosaic.html#mosaic.SingleChannelAnalysis.SingleChannelAnalysis" title="mosaic.SingleChannelAnalysis.SingleChannelAnalysis"><tt class="xref py py-class docutils literal"><span class="pre">SingleChannelAnalysis</span></tt></a> object. In the code above, the ABF data is filtered using a <a class="reference internal" href="../api-doc/mosaic.filter.html#mosaic.besselLowpassFilter.besselLowpassFilter" title="mosaic.besselLowpassFilter.besselLowpassFilter"><tt class="xref py py-class docutils literal"><span class="pre">besselLowpassFilter</span></tt></a>. Parameters for the filter are defined within the settings file as described in the <a class="reference internal" href="settingsFile.html#settings-page"><em>Settings File</em></a> section.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="s2">&quot;besselLowpassFilter&quot;</span> <span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;filterOrder&quot;</span>    <span class="o">:</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;filterCutoff&quot;</span>   <span class="o">:</span> <span class="s2">&quot;10000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;decimate&quot;</span>       <span class="o">:</span> <span class="s2">&quot;1&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A similar approach can be used to filter data using a <a class="reference internal" href="../api-doc/mosaic.filter.html#mosaic.waveletDenoiseFilter.waveletDenoiseFilter" title="mosaic.waveletDenoiseFilter.waveletDenoiseFilter"><tt class="xref py py-class docutils literal"><span class="pre">waveletDenoiseFilter</span></tt></a> or a tap delay line (<a class="reference internal" href="../api-doc/mosaic.filter.html#mosaic.convolutionFilter.convolutionFilter" title="mosaic.convolutionFilter.convolutionFilter"><tt class="xref py py-class docutils literal"><span class="pre">convolutionFilter</span></tt></a>). Additional filters can be easily added to <em>MOSAIC</em> as described in <a class="reference internal" href="Extend.html#extend-page"><em>Extend MOSAIC</em></a>.</p>
</div>
</div>
<div class="section" id="advanced-scripting">
<h2>4.2. Advanced Scripting<a class="headerlink" href="#advanced-scripting" title="Permalink to this headline">¶</a></h2>
<p>Scripting with <a class="reference external" href="http://www.python.org/">Python</a> allows transforming the output of the <em>MOSAIC</em> further to generate plots, perform additional analysis or extend functionality. Moreover, individual components of the <em>MOSAIC</em> module, which forms the back end code executed in the data processing pipeline, can be used for specific tasks. In this section, we highlight a few typical use cases.</p>
<p><strong>Plot the Ionic Current Time-Series</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">mosaic.abfTrajIO</span> <span class="kn">as</span> <span class="nn">abf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">abfDat</span><span class="o">=</span><span class="n">abf</span><span class="o">.</span><span class="n">abfTrajIO</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="s">&#39;~/abfSet1/&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s">&#39;*.abf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mf">500000.</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">popdata</span><span class="p">(</span><span class="mi">500000</span><span class="p">),</span> <span class="s">&#39;b.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;t (s)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;-i (pA)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>It is useful to visualize time-series data to highlight unique characteristics of a sample. For example the sample code above was used to load 1 second of monodisperse PEG28 data, sampled at 500 kHz. The data was read using a <a class="reference internal" href="../api-doc/mosaic.traj.html#mosaic.abfTrajIO.abfTrajIO" title="mosaic.abfTrajIO.abfTrajIO"><tt class="xref py py-class docutils literal"><span class="pre">abfTrajIO</span></tt></a> object similar to the examples above. The <a class="reference internal" href="../api-doc/mosaic.meta.html#mosaic.metaTrajIO.metaTrajIO.popdata" title="mosaic.metaTrajIO.metaTrajIO.popdata"><tt class="xref py py-meth docutils literal"><span class="pre">popdata()</span></tt></a> command was used to take 500k data points (or 1 second) and then plot a time-series using <a class="reference external" href="http://matplotlib.org/">matplotlib</a> (see figure below). Calling popdata a second time will return the next <em>n</em> points.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/advancedFig2.png"><img alt="../_images/advancedFig2.png" src="../_images/advancedFig2.png" style="width: 50%;" /></a>
</div>
<p><strong>Estimate the Channel Gating Duration</strong></p>
<p>Scripting can be used to obtain statistics from the raw time-series. In the code snippet below, we estimate the amount of time a channel spends in a gated state by combining modules defined within <em>MOSAIC</em>. The analysis is performed in blocks for efficiency. We first define a Python function that takes multiple arguments including  <em>TrajIO</em> object, the threshold at which we want to define the gated state in pA (gatingcurrentpa), the block size in seconds (blocksz), the total time of the time-series being processed in seconds (totaltime) and the sampling rate of the data in Hz (fshz). The code then calculates the number of blocks in which the channel was in a gated state and returns the time spent in that state in seconds.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">mosaic.abfTrajIO</span> <span class="kn">as</span> <span class="nn">abf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">estimateGatingDuration</span><span class="p">(</span> <span class="n">trajioobj</span><span class="p">,</span> <span class="n">gatingcurrentpa</span><span class="p">,</span> <span class="n">blocksz</span><span class="p">,</span> <span class="n">totaltime</span><span class="p">,</span> <span class="n">fshz</span> <span class="p">):</span>
    <span class="n">npts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">fshz</span><span class="p">)</span><span class="o">*</span><span class="n">blocksz</span><span class="p">)</span>
    <span class="n">nblk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">totaltime</span><span class="o">/</span><span class="n">blocksz</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

    <span class="c"># Iterate over the blocks of data and check if the channel was in a gated state.</span>
    <span class="c"># The code below returns the mean ionic current of blocks that are below the gating</span>
    <span class="c"># threshold (gatingcurrentpa)</span>
    <span class="n">gEvents</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span>  <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">&lt;</span><span class="nb">float</span><span class="p">(</span><span class="n">gatingcurrentpa</span><span class="p">),</span>
                       <span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trajioobj</span><span class="o">.</span><span class="n">popdata</span><span class="p">(</span><span class="n">npts</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nblk</span><span class="p">)</span> <span class="p">])</span>

    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">gEvents</span><span class="p">)</span><span class="o">*</span><span class="n">blocksz</span>

<span class="n">abfObj</span><span class="o">=</span><span class="n">abf</span><span class="o">.</span><span class="n">abfTrajIO</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="s">&#39;~/abfSet1&#39;</span><span class="p">,</span><span class="nb">filter</span><span class="o">=</span><span class="s">&#39;*.abf&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">estimateGatingDuration</span><span class="p">(</span> <span class="n">abfObj</span><span class="p">,</span> <span class="mf">20.</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">abfObj</span><span class="o">.</span><span class="n">FsHz</span> <span class="p">)</span>
</pre></div>
</div>
<p><strong>Plot the Output of an Analysis</strong></p>
<p>This final example shows how one can use <em>MOSAIC</em> to process an ionic current time-series and then build a custom script that further analyses and plots the results. This example uses single-molecule mass spectrometry (SMMS) data from <a class="reference external" href="http://www.pnas.org/content/104/20/8207">Robertson et al., PNAS 2007</a>.</p>
<p>In the code below, we first process all the ABF files in a specified directory similar to the examples in previous sections. Upon completion of the analysis, the results are stored in a <a class="reference external" href="http://www.sqlite.org/">SQLite</a> database, which can be then queried using the structured query language (<a class="reference external" href="http://en.wikipedia.org/wiki/SQL">SQL</a>).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">mosaic.qdfTrajIO</span> <span class="kn">as</span> <span class="nn">qdf</span>
<span class="kn">import</span> <span class="nn">mosaic.abfTrajIO</span> <span class="kn">as</span> <span class="nn">abf</span>

<span class="kn">import</span> <span class="nn">mosaic.SingleChannelAnalysis</span>
<span class="kn">import</span> <span class="nn">mosaic.eventSegment</span> <span class="kn">as</span> <span class="nn">es</span>
<span class="kn">import</span> <span class="nn">mosaic.stepResponseAnalysis</span> <span class="kn">as</span> <span class="nn">sra</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mosaic.sqlite3MDIO</span> <span class="kn">as</span> <span class="nn">sql</span>

<span class="c"># Process all ABF files in a directory</span>
<span class="n">mosaic</span><span class="o">.</span><span class="n">SingleChannelAnalysis</span><span class="o">.</span><span class="n">SingleChannelAnalysis</span><span class="p">(</span>
            <span class="s">&#39;~/ReferenceData/abfSet1&#39;</span><span class="p">,</span>
            <span class="n">abf</span><span class="o">.</span><span class="n">abfTrajIO</span><span class="p">,</span>
            <span class="bp">None</span><span class="p">,</span>
            <span class="n">es</span><span class="o">.</span><span class="n">eventSegment</span><span class="p">,</span>
            <span class="n">sra</span><span class="o">.</span><span class="n">stepResponseAnalysis</span>
        <span class="p">)</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>


<span class="c"># Load the results of the analysis</span>
<span class="n">s</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">sqlite3MDIO</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">openDB</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;~/ReferenceData/abfSet1/*sqlite&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c"># We first set up a string that holds the query to retrieve the analysis results. Note that {col}</span>
<span class="c"># will be replaced with the name of the database column when we run the query below.</span>
<span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select {col} from metadata where ProcessingStatus=&#39;normal&#39; and ResTime &gt; 0.2 </span><span class="se">\</span>
<span class="s">     and BlockDepth between 0.15 and 0.55&quot;</span>

<span class="c"># Now we run two separate queries - the first returns the blockade depth</span>
<span class="c"># and the second returns the residence time. Note that we simply take the query</span>
<span class="c"># string &#39;q&#39; above and replace {col} with the column name.</span>
<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">queryDB</span><span class="p">(</span> <span class="n">q</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s">&#39;BlockDepth&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">queryDB</span><span class="p">(</span> <span class="n">q</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s">&#39;ResTime&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

<span class="c"># Use matplotlib to plot the results with 2 views:</span>
<span class="c"># i)  a 1D histogram of blockade depths and</span>
<span class="c"># ii) a 2D histogram of the residence times vs. blockade depth</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s">&#39;Residence Time vs. Blockade Depth&#39;</span><span class="p">)</span>

<span class="n">pl</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xticks</span><span class="p">(())</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Counts&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">pl</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Blockade Depth&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Residence Time (ms)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>

<span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Next, we generate a two pane plot using <a class="reference external" href="http://matplotlib.org/">matplotlib</a>. The top pane contains a histogram of the blockade depth, while the bottom pane plots a 2D histogram of residence time vs. blockade depth.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/advancedFig3.png"><img alt="../_images/advancedFig3.png" src="../_images/advancedFig3.png" style="width: 50%;" /></a>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/icon.png" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted.html">2. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="GraphicalInterface.html">3. <em>MOSAIC</em> GUI</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">4. Scripting and Advanced Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#import-data-and-run-an-analysis">4.1. Import Data and Run an Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-scripting">4.2. Advanced Scripting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="settingsFile.html">5. Settings File</a></li>
<li class="toctree-l1"><a class="reference internal" href="DatabaseStructure.html">6. Database Structure and Query Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="Extend.html">7. Extend <em>MOSAIC</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="Addons.html">8. Addons</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">9. Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidocs.html">10. API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChangeLog.html">11. Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="References.html">12. Bibliography</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3 class="searchheading" align="left">Questions/Suggestions</h3>
<div class="sphinxsidebarsection" align="left">
<p />
<p class="logo">
<a href="http://www.nist.gov/cgi-bin/wwwph/cso.nist.gov?Query=Arvind+Balijepalli" style=""><u>Contact Us</u></a><br />
<!-- 
http://www.nist.gov/cgi-bin/wwwph/cso.nist.gov?Query=Arvind+Balijepalli
mailto:arvind.balijepalli@nist.gov
 -->
<!-- <em><small><br/> National Institute of Standards and Technology<br/>
 100 Bureau Drive<br/>
 Gaithersburg, MD 20899<br/></small></em>
 -->
 <br/>
You can report problems with <em>MOSAIC</em> using the<a class="" href="https://github.com/usnistgov/mosaic/issues" style=""><u>issue tracker.</u></a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="settingsFile.html" title="5. Settings File"
             >next</a> |</li>
        <li class="right" >
          <a href="GraphicalInterface.html" title="3. MOSAIC GUI"
             >previous</a> |</li>
        <li><a href="../index.html">MOSAIC 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
<!-- 
    <div class="footer">
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div> -->
<div class="footer" style="vertical-align: center">
National Institute of Standards and Technology,&nbsp;
<a href="Disclaimer.html"><em>Terms of Use</em></a>
</div>

  </body>
</html>