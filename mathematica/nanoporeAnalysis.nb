(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     55550,       1340]
NotebookOptionsPosition[     53822,       1280]
NotebookOutlinePosition[     54205,       1297]
CellTagsIndexPosition[     54162,       1294]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"<<", "Util`"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.571950305351722*^9, 3.5719503070462933`*^9}}],

Cell[CellGroupData[{

Cell["Run Analysis", "Subsubsection",
 CellChangeTimes->{{3.5873734870989656`*^9, 3.5873734893624163`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"pySetup", "[", "]"}], ":=", 
  "\"\<\nimport SingleChannelAnalysis\n\nfrom eventSegment import *\n\nfrom \
singleStepEvent import *\nfrom stepResponseAnalysis import *\nfrom \
multiStateAnalysis import *\n\nfrom qdfTrajIO import *\nfrom abfTrajIO import \
*\nfrom tsvTrajIO import *\nfrom binTrajIO import *\n\nfrom \
besselLowpassFilter import *\nfrom convolutionFilter import *\\n\\n\>\""}]], \
"Input",
 InitializationCell->True,
 CellChangeTimes->{{3.587326056557321*^9, 3.587326067148013*^9}, {
  3.587326099875936*^9, 3.58732610359722*^9}, {3.587326234059906*^9, 
  3.58732626316818*^9}, {3.587326429494646*^9, 3.587326431444117*^9}, {
  3.587326723191869*^9, 3.587326751393264*^9}, {3.589208032336199*^9, 
  3.589208037912417*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"pyAnalysisCommand", "[", 
   RowBox[{
   "datpath_", ",", "filetype_", ",", "fileopts_", ",", "segment_", ",", 
    "analysis_"}], "]"}], ":=", 
  RowBox[{
  "\"\<SingleChannelAnalysis.SingleChannelAnalysis(\n\\t\\t\\t\>\"", "<>", 
   "filetype", "<>", "\"\<(dirname='\>\"", "<>", "datpath", "<>", 
   "\"\<',\>\"", "<>", "fileopts", "<>", "\"\<),\n\\t\\t\\t\>\"", "<>", 
   "segment", "<>", "\"\<,\n\\t\\t\\t\>\"", "<>", "analysis", "<>", 
   "\"\<\n\\t\\t).Run()\>\""}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.587326131258567*^9, 3.5873261937066517`*^9}, {
   3.587326293265522*^9, 3.587326310984103*^9}, {3.587326341627479*^9, 
   3.587326372067938*^9}, {3.587326606778077*^9, 3.5873266192392807`*^9}, {
   3.587326653239827*^9, 3.587326689658883*^9}, 3.587326779011442*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GenPytonScript", "[", 
   RowBox[{
   "datapath_", ",", "filetype_", ",", "fileopts_", ",", "segment_", ",", 
    "analysis_", ",", "coderoot_"}], "]"}], ":=", 
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"coderoot", "<>", "\"\</analysisScript.py\>\""}], ",", 
    RowBox[{
     RowBox[{"pySetup", "[", "]"}], "<>", 
     RowBox[{"pyAnalysisCommand", "[", 
      RowBox[{
      "datapath", ",", "filetype", ",", "fileopts", ",", "segment", ",", 
       "analysis"}], "]"}]}], ",", "\"\<Text\>\""}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5873268829334993`*^9, 3.587326968543475*^9}, {
  3.587327030485941*^9, 3.587327035203208*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"WriteSettings", "[", 
   RowBox[{"settingspath_", ",", "ethresh_", ",", "writets_", ",", 
    RowBox[{"meancurr_:", "-", "1"}], ",", 
    RowBox[{"sdcurr_:", "-", "1"}], ",", 
    RowBox[{"slopecurr_:", "-", "1"}], ",", 
    RowBox[{"mineventlen_:", "5"}]}], "]"}], ":=", 
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"settingspath", "<>", "\"\</.settings\>\""}], ",", 
    RowBox[{
    "\"\<{\n\\t\\\"eventSegment\\\" : {\n\\t\\t\\\"blockSizeSec\\\" \\t\\t: \
\\\"0.5\\\",\n\\t\\t\\\"eventPad\\\" \\t\\t: \\\"50\\\",\n\
\\t\\t\\\"minEventLength\\\" \\t: \\\"\>\"", "<>", 
     RowBox[{"ToString", "[", "mineventlen", "]"}], "<>", 
     "\"\<\\\",\n\\t\\t\\\"eventThreshold\\\" \\t: \\\"\>\"", "<>", 
     RowBox[{"ToString", "[", "ethresh", "]"}], "<>", 
     "\"\<\\\",\n\\t\\t\\\"driftThreshold\\\" \\t: \\\"9999.0\\\",\n\
\\t\\t\\\"maxDriftRate\\\" \\t\\t: \\\"100000.0\\\",\n\
\\t\\t\\\"meanOpenCurr\\\"\\t\\t: \\\"\>\"", "<>", 
     RowBox[{"ToString", "[", "meancurr", "]"}], "<>", 
     "\"\<\\\",\n\\t\\t\\\"sdOpenCurr\\\"\\t\\t: \\\"\>\"", "<>", 
     RowBox[{"ToString", "[", "sdcurr", "]"}], "<>", 
     "\"\<\\\",\n\\t\\t\\\"slopeOpenCurr\\\"\\t\\t: \\\"\>\"", "<>", 
     RowBox[{"ToString", "[", "slopecurr", "]"}], "<>", 
     "\"\<\\\",\n\\t\\t\\\"writeEventTS\\\"\\t\\t: \\\"\>\"", "<>", 
     RowBox[{"ToString", "[", "writets", "]"}], "<>", 
     "\"\<\\\",\n\\t\\t\\\"parallelProc\\\"\\t\\t: \\\"0\\\",\n\
\\t\\t\\\"reserveNCPU\\\"\\t\\t: \\\"5\\\",\n\\t\\t\\\"plotResults\\\"\\t\\t: \
\\\"0\\\"\n\\t},\n\\t\\\"singleStepEvent\\\" : {\n\\t\\t\\\"binSize\\\" \
\\t\\t: \\\"1.0\\\",\n\\t\\t\\\"histPad\\\" \\t\\t: \\\"10\\\",\n\
\\t\\t\\\"maxFitIters\\\"\\t\\t: \\\"5000\\\",\n\\t\\t\\\"a12Ratio\\\" \
\\t\\t: \\\"1.e4\\\",\n\\t\\t\\\"minEvntTime\\\" \\t\\t: \\\"10.e-6\\\",\n\\t\
\\t\\\"minDataPad\\\" \\t\\t: \\\"75\\\"\n\\t},\n\
\\t\\\"stepResponseAnalysis\\\" : {\n\\t\\t\\\"FitTol\\\"\\t\\t: \
\\\"1.e-7\\\",\n\\t\\t\\\"FitIters\\\"\\t\\t: \\\"10000\\\",\n\
\\t\\t\\\"BlockRejectRatio\\\"\\t: \\\"0.9\\\"\n\\t},\n\
\\t\\\"multiStateAnalysis\\\" : {\n\\t\\t\\\"FitTol\\\"\\t\\t: \\\"1.e-7\\\",\
\n\\t\\t\\\"FitIters\\\"\\t\\t: \\\"10000\\\",\n\
\\t\\t\\\"InitThreshold\\\"\\t: \\\"\>\"", "<>", 
     RowBox[{"ToString", "[", "ethresh", "]"}], "<>", 
     "\"\<\\\"\n\\t},\n\\t\\\"besselLowpassFilter\\\" : {\n\
\\t\\t\\\"filterOrder\\\"\\t\\t: \\\"6\\\",\n\
\\t\\t\\\"filterCutoff\\\"\\t\\t: \\\"10000\\\",\n\
\\t\\t\\\"decimate\\\"\\t\\t: \\\"1\\\"\\t\n\\t}\n}\>\""}], ",", 
    "\"\<Text\>\""}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.589132115522781*^9, 3.589132338148005*^9}, {
  3.589132386839488*^9, 3.589132388894305*^9}, {3.5892078011088057`*^9, 
  3.5892078275027447`*^9}, {3.5899646837603207`*^9, 3.5899646914533663`*^9}, {
  3.589964754675891*^9, 3.5899647589890013`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"RunAnalysis", "[", 
   RowBox[{
   "datapath_", ",", "filetype_", ",", "fileopts_", ",", "segment_", ",", 
    "analysis_", ",", "coderoot_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"GenPytonScript", "[", 
      RowBox[{
      "datapath", ",", "filetype", ",", "fileopts", ",", "segment", ",", 
       "analysis", ",", "coderoot"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ReadList", "[", 
      RowBox[{
      "\"\<!sh \>\"", "<>", "coderoot", "<>", 
       "\"\</mathematica/runAnalysis.sh \>\"", "<>", " ", "coderoot", " ", 
       "<>", "\"\< &> \>\"", "<>", "coderoot", "<>", "\"\</.tmp\>\""}], "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"FilePrint", "[", 
      RowBox[{"coderoot", "<>", "\"\</.tmp\>\""}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.587325451202462*^9, 3.587325457581128*^9}, {
   3.587325495618865*^9, 3.587325584408505*^9}, {3.587325618628128*^9, 
   3.58732563125243*^9}, {3.587325824630863*^9, 3.5873258317700787`*^9}, 
   3.5873259752804947`*^9, {3.587326582340345*^9, 3.587326587920114*^9}, {
   3.587327872126903*^9, 3.58732795196519*^9}, 3.587328514553878*^9, {
   3.587328545177464*^9, 3.587328572124382*^9}, {3.5873286417845984`*^9, 
   3.5873286452766457`*^9}, {3.5873288059438887`*^9, 3.587328836003735*^9}, {
   3.587329364467284*^9, 3.587329371485207*^9}, {3.587329431501028*^9, 
   3.5873294672306347`*^9}, {3.587335388490719*^9, 3.587335396989362*^9}, {
   3.5873355649361143`*^9, 3.587335566512889*^9}, {3.587336085215946*^9, 
   3.5873360899904118`*^9}, {3.587336653621986*^9, 3.587336656173903*^9}, 
   3.587336714416629*^9, {3.5873372895624037`*^9, 3.587337290739373*^9}, {
   3.587337395998551*^9, 3.587337462617961*^9}, 3.5873730445211*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Plot Results", "Subsubsection",
 CellChangeTimes->{{3.587373495498486*^9, 3.587373498562153*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PrintMDKeys", "[", "filename_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"db", "=", 
       RowBox[{"Database`OpenDatabase", "[", "filename", "]"}]}], ",", 
      "keys"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"keys", "=", 
      RowBox[{
       RowBox[{"Database`QueryDatabase", "[", 
        RowBox[{"db", ",", "\"\<PRAGMA table_info(metadata);\>\""}], "]"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Database`CloseDatabase", "[", "db", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "keys", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.609433638731332*^9, 3.60943374132913*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"QueryDB", "[", 
   RowBox[{
   "filename_", ",", "cols_", ",", " ", "status_", ",", " ", "query_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"db", "=", 
       RowBox[{"Database`OpenDatabase", "[", "filename", "]"}]}], ",", "q", 
      ",", "res"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"q", "=", 
      RowBox[{"querystring", "[", 
       RowBox[{"cols", ",", " ", "status", ",", " ", "query"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"res", "=", 
      RowBox[{"Database`QueryDatabase", "[", 
       RowBox[{"db", ",", 
        RowBox[{"q", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        ",", 
        RowBox[{"q", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Database`CloseDatabase", "[", "db", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "res", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"querystring", "[", 
   RowBox[{"cols_", ",", "status_", ",", "query_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<select \>\"", "<>", 
      RowBox[{"ToString", "[", "cols", "]"}], "<>", 
      "\"\< from metadata where ( ProcessingStatus = ? and \>\"", "<>", 
      RowBox[{"ToString", "[", "query", "]"}], "<>", " ", "\"\< )\>\""}], ",", 
     RowBox[{"{", 
      RowBox[{"ToString", "[", 
       RowBox[{"status", ",", 
        RowBox[{"CharacterEncoding", "\[Rule]", "\"\<UTF-8\>\""}]}], "]"}], 
      "}"}]}], "}"}], "/;", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"status", " ", "\[NotEqual]", "\"\<*\>\""}], "&&", 
     RowBox[{"query", "\[NotEqual]", "\"\<\>\""}]}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"querystring", "[", 
   RowBox[{"cols_", ",", "status_", ",", "query_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<select \>\"", "<>", 
      RowBox[{"ToString", "[", "cols", "]"}], "<>", 
      "\"\< from metadata where ( \>\"", "<>", 
      RowBox[{"ToString", "[", "query", "]"}], "<>", " ", "\"\< )\>\""}], ",", 
     RowBox[{"{", "}"}]}], "}"}], "/;", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"status", "\[Equal]", "\"\<*\>\""}], "&&", " ", 
     RowBox[{"query", " ", "\[NotEqual]", "\"\<\>\""}]}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"querystring", "[", 
   RowBox[{"cols_", ",", "status_", ",", "query_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<select \>\"", "<>", 
      RowBox[{"ToString", "[", "cols", "]"}], "<>", 
      "\"\< from metadata\>\""}], ",", 
     RowBox[{"{", "}"}]}], "}"}], "/;", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"status", "\[Equal]", "\"\<*\>\""}], "&&", " ", 
     RowBox[{"query", " ", "\[Equal]", "\"\<\>\""}]}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"querystring", "[", 
    RowBox[{"cols_", ",", "status_", ",", "query_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<select \>\"", "<>", 
      RowBox[{"ToString", "[", "cols", "]"}], "<>", 
      "\"\< from metadata where ( ProcessingStatus = ? )\>\""}], ",", 
     RowBox[{"{", 
      RowBox[{"ToString", "[", 
       RowBox[{"status", ",", 
        RowBox[{"CharacterEncoding", "\[Rule]", "\"\<UTF-8\>\""}]}], "]"}], 
      "}"}]}], "}"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6094335729232397`*^9, {3.6094338690013514`*^9, 3.609433872990109*^9}, {
   3.6094339468836527`*^9, 3.6094340041292753`*^9}, {3.6094340772701178`*^9, 
   3.609434088628983*^9}, {3.609434124420302*^9, 3.609434201544586*^9}, {
   3.609434246048018*^9, 3.609434311126128*^9}, {3.609434381204571*^9, 
   3.6094344490978603`*^9}, {3.6094877187976933`*^9, 3.609487741024979*^9}, {
   3.609487792314891*^9, 3.609487792837831*^9}, {3.609487841397956*^9, 
   3.6094878659702177`*^9}, {3.60948796587006*^9, 3.609487974808069*^9}, 
   3.609488013495297*^9, {3.609488196284172*^9, 3.6094882052028913`*^9}, 
   3.609488260403801*^9, 3.609488407550002*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"DecodeTimeSeries", "[", "ts_", "]"}], ":=", 
  RowBox[{"ImportString", "[", 
   RowBox[{
    RowBox[{"ImportString", "[", 
     RowBox[{
      RowBox[{"ToString", "[", "ts", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<Base64\>\"", ",", "\"\<String\>\""}], "}"}]}], "]"}], 
    ",", "\"\<Real64\>\""}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.609417561613099*^9, 3.609417581427391*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"PrintMDKeys", "[", 
  RowBox[{
   RowBox[{"FileNames", "[", 
    RowBox[{
    "\"\<*sqlite\>\"", ",", 
     "\"\</Users/arvind/Research/Experiments/SBSTagsColumbia/dA6TP30odd/\
p100mV3/\>\""}], "]"}], "\[LeftDoubleBracket]", 
   RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"\<\"recIDX\"\>", ",", "\<\"ProcessingStatus\"\>", 
   ",", "\<\"OpenChCurrent\"\>", ",", "\<\"CurrentStep\"\>", 
   ",", "\<\"EventStart\"\>", ",", "\<\"EventEnd\"\>", 
   ",", "\<\"EventDelay\"\>", ",", "\<\"ResTime\"\>", 
   ",", "\<\"RCConstant\"\>", ",", "\<\"ReducedChiSquared\"\>", 
   ",", "\<\"TimeSeries\"\>"}], "}"}]], "Output",
 CellChangeTimes->{3.612133528962566*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ts", "[", 
   RowBox[{"dat_", ",", "FsKHz_"}], "]"}], ":=", 
  RowBox[{"Transpose", "[", 
   RowBox[{"{", 
    RowBox[{
     FractionBox[
      RowBox[{"Range", "[", 
       RowBox[{"0", ",", 
        RowBox[{
         RowBox[{"Length", "[", "dat", "]"}], "-", "1"}]}], "]"}], "FsKHz"], 
     ",", "dat"}], "}"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.609454949746669*^9, 3.609454986498221*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotEvents", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"AnalysisAlgorithm", "\[Rule]", "\"\<StepResponseAnalysis\>\""}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PlotEvents", "[", 
   RowBox[{"dbname_", ",", "FsKHz_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "q", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"q", "=", 
       RowBox[{"QueryDB", "[", "\[IndentingNewLine]", "\t\t\t", 
        RowBox[{
        "dbname", ",", " ", "\[IndentingNewLine]", "\t\t\t", 
         "\"\<ProcessingStatus, BlockedCurrent, OpenChCurrent, EventStart, \
EventEnd, RCConstant, TimeSeries\>\"", ",", "\[IndentingNewLine]", "\t\t\t", 
         "\"\<*\>\"", ",", "\[IndentingNewLine]", "\t\t\t", "\"\<\>\""}], 
        "\[IndentingNewLine]", "\t\t", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Manipulate", "[", 
       RowBox[{
        RowBox[{"plotsra", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "q", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
           "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", " ", 
          RowBox[{"ts", "[", 
           RowBox[{
            RowBox[{"DecodeTimeSeries", "[", 
             RowBox[{
              RowBox[{
              "q", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
            "FsKHz"}], "]"}], ",", 
          RowBox[{
           RowBox[{
           "q", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
           "\[LeftDoubleBracket]", 
           RowBox[{"2", ";;", 
            RowBox[{"-", "2"}]}], "\[RightDoubleBracket]"}], " ", ",", 
          "FsKHz"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "q", "]"}], ",", "1", ",", 
          RowBox[{"Appearance", "\[Rule]", "\"\<Open\>\""}]}], "}"}]}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}], "/;", 
   RowBox[{
    RowBox[{"OptionValue", "[", "AnalysisAlgorithm", "]"}], "\[Equal]", 
    "\"\<StepResponseAnalysis\>\""}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PlotEvents", "[", 
   RowBox[{"dbname_", ",", "FsKHz_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "q", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"q", "=", 
       RowBox[{"QueryDB", "[", "\[IndentingNewLine]", "\t\t\t", 
        RowBox[{
        "dbname", ",", " ", "\[IndentingNewLine]", "\t\t\t", 
         "\"\<ProcessingStatus, OpenChCurrent, CurrentStep, EventDelay, \
RCConstant, TimeSeries\>\"", ",", "\[IndentingNewLine]", "\t\t\t", 
         "\"\<*\>\"", ",", "\[IndentingNewLine]", "\t\t\t", "\"\<\>\""}], 
        "\[IndentingNewLine]", "\t\t", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Manipulate", "[", 
       RowBox[{
        RowBox[{"plotmsa", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "q", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
           "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", " ", 
          RowBox[{"ts", "[", 
           RowBox[{
            RowBox[{"DecodeTimeSeries", "[", 
             RowBox[{
              RowBox[{
              "q", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
            "FsKHz"}], "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
             "q", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
             "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
            RowBox[{"DecodeTimeSeries", "[", 
             RowBox[{
              RowBox[{
              "q", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], "]"}], 
            ",", 
            RowBox[{"DecodeTimeSeries", "[", 
             RowBox[{
              RowBox[{
              "q", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], "]"}], 
            ",", 
            RowBox[{
             RowBox[{
             "q", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
             "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}], "}"}], 
          ",", "FsKHz"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "q", "]"}], ",", "1", ",", 
          RowBox[{"Appearance", "\[Rule]", "\"\<Open\>\""}]}], "}"}]}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}], "/;", 
   RowBox[{
    RowBox[{"OptionValue", "[", "AnalysisAlgorithm", "]"}], "\[Equal]", 
    "\"\<MultiStateAnalysis\>\""}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.609454539613843*^9, 3.60945468647892*^9}, {
   3.6094547316223707`*^9, 3.6094548330564957`*^9}, {3.609454881375451*^9, 
   3.6094549308533163`*^9}, {3.609455000457119*^9, 3.6094550535538883`*^9}, {
   3.609455159781485*^9, 3.609455221164176*^9}, 3.6094552520116568`*^9, {
   3.60945528220892*^9, 3.609455285688118*^9}, {3.609455318487586*^9, 
   3.609455332312317*^9}, {3.609455371772635*^9, 3.609455527712956*^9}, {
   3.609455618931398*^9, 3.609455625758309*^9}, {3.6094556807472677`*^9, 
   3.6094557697951517`*^9}, 3.609455824521036*^9, {3.6094558795134783`*^9, 
   3.60945592210279*^9}, {3.609455964245205*^9, 3.609456070336137*^9}, {
   3.609456137814843*^9, 3.609456225475937*^9}, {3.609456281134213*^9, 
   3.609456290649866*^9}, {3.609456395607806*^9, 3.609456442562114*^9}, {
   3.609488677803039*^9, 3.609488760756506*^9}, {3.609488836025797*^9, 
   3.6094888933656054`*^9}, 3.60948892795173*^9, {3.60948899114574*^9, 
   3.60948899214509*^9}, {3.6094891122599583`*^9, 3.6094891186699877`*^9}, {
   3.6094892508801117`*^9, 3.609489252686977*^9}, {3.60948928511199*^9, 
   3.609489315142289*^9}, {3.612133352520033*^9, 3.612133361273239*^9}, {
   3.612133535208131*^9, 3.612133602012578*^9}, {3.6121336471204433`*^9, 
   3.6121336552223167`*^9}, {3.612133739682914*^9, 3.612133756925213*^9}, {
   3.6121340946781607`*^9, 3.612134096362884*^9}, {3.612134334090122*^9, 
   3.61213433516683*^9}, {3.6121347443467903`*^9, 3.612134751659946*^9}}],

Cell[BoxData[
 RowBox[{"Prolog", "\[Rule]", 
  RowBox[{"{", 
   RowBox[{"Thick", ",", "Dashed", ",", 
    RowBox[{"Darker", "[", "Red", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"md", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
          ",", 
         RowBox[{"Abs", "[", 
          RowBox[{
          "md", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"md", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}],
          ",", 
         RowBox[{"Abs", "[", 
          RowBox[{
          "md", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "]"}]}], "}"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"md", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
          ",", 
         RowBox[{"Abs", "[", 
          RowBox[{
          "md", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
          "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"md", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
          ",", 
         RowBox[{"Abs", "[", 
          RowBox[{
          "md", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "]"}]}], "}"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"md", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}],
          ",", 
         RowBox[{"Abs", "[", 
          RowBox[{
          "md", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
          "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"md", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}],
          ",", 
         RowBox[{"Abs", "[", 
          RowBox[{
          "md", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "]"}]}], "}"}]}], "}"}], "]"}]}], "\[IndentingNewLine]", 
   "}"}]}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"plotmsa", "[", 
   RowBox[{"status_", ",", "ts_", ",", "md_", ",", "FsKHz_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "a", ",", "\[Mu]1", ",", "\[Mu]2", ",", "\[Tau]", ",", "b"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"Abs", "[", "ts", "]"}], ",", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "25"}], ",", "All"}], "}"}]}], ",", 
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"Directive", "[", 
             RowBox[{
              RowBox[{"RGBColor", "@@", 
               FractionBox[
                RowBox[{"{", 
                 RowBox[{"41", ",", " ", "74", ",", "130"}], "}"}], "255"]}], 
              ",", 
              RowBox[{"Opacity", "[", "0.4", "]"}]}], "]"}]}], ",", 
           RowBox[{"PlotMarkers", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Automatic", ",", "14"}], "}"}]}], ",", 
           RowBox[{"Frame", "\[Rule]", "True"}], ",", 
           RowBox[{"FrameLabel", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{"\"\<t (ms)\>\"", ",", "20", ",", 
                RowBox[{"FontFamily", "\[Rule]", "\"\<Helvectica\>\""}]}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<|i| (pA)\>\"", ",", "20", ",", 
                RowBox[{"FontFamily", "\[Rule]", "\"\<Helvectica\>\""}]}], 
               "]"}]}], "}"}]}], ",", 
           RowBox[{"FrameTicksStyle", "\[Rule]", 
            RowBox[{"Directive", "[", 
             RowBox[{"20", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Helvectica\>\""}]}], 
             "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"t", ",", 
                 RowBox[{"Evaluate", "[", 
                  RowBox[{
                   RowBox[{"Abs", "[", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}], "+", 
                   RowBox[{
                    UnderoverscriptBox["\[Sum]", 
                    RowBox[{"i", "=", "1"}], 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}]], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], 
                    RowBox[{"HeavisideTheta", "[", 
                    RowBox[{"t", "-", 
                    RowBox[{
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}]}], "]"}]}], ")"}]}]}], "]"}]}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"t", ",", 
                 RowBox[{
                  RowBox[{
                  "ts", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}], ",", 
                 RowBox[{
                  RowBox[{"ts", "\[LeftDoubleBracket]", 
                   RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], 
                  "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
                 FractionBox[
                  RowBox[{"1", "/", "FsKHz"}], "10"]}], "}"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"t", ",", 
                 RowBox[{"Evaluate", "[", 
                  RowBox[{
                   RowBox[{"Abs", "[", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}], "+", 
                   RowBox[{
                    UnderoverscriptBox["\[Sum]", 
                    RowBox[{"i", "=", "1"}], 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}]], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"Exp", "[", 
                    FractionBox[
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"t", "-", 
                    RowBox[{
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}]}], ")"}]}], 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}]], "]"}]}], ")"}], 
                    RowBox[{"HeavisideTheta", "[", 
                    RowBox[{"t", "-", 
                    RowBox[{
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}]}], "]"}]}], ")"}]}]}], "]"}]}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"t", ",", 
                 RowBox[{
                  RowBox[{
                  "ts", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}], ",", 
                 RowBox[{
                  RowBox[{"ts", "\[LeftDoubleBracket]", 
                   RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], 
                  "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
                 FractionBox[
                  RowBox[{"1", "/", "FsKHz"}], "10"]}], "}"}]}], "]"}]}], 
            "\[IndentingNewLine]", "}"}], ",", 
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"ColorData", "[", "\"\<DarkRainbow\>\"", "]"}], "[", 
                 "0.95", "]"}], ",", "Dashed", ",", 
                RowBox[{"Thickness", "[", "0.005", "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"Black", ",", 
                RowBox[{"Dashing", "[", 
                 RowBox[{"{", "}"}], "]"}], ",", 
                RowBox[{"Thickness", "[", "0.005", "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"Black", ",", 
                RowBox[{"Thickness", "[", "0.005", "]"}]}], "}"}]}], "}"}]}], 
           ",", 
           RowBox[{"Joined", "\[Rule]", "True"}]}], "]"}]}], 
        "\[IndentingNewLine]", "}"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "600"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}], "/;", 
   RowBox[{
   "status", "\[Equal]", "\"\<normal\>\""}]}]}], "\[IndentingNewLine]", 
 RowBox[{" ", 
  RowBox[{
   RowBox[{"plotmsa", "[", 
    RowBox[{"status_", ",", "ts_", ",", "md_", ",", "FsKHz_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "a", ",", "\[Mu]1", ",", "\[Mu]2", ",", "\[Tau]", ",", "b"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"Abs", "[", "ts", "]"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", 
          RowBox[{"PlotMarkers", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"Automatic", ",", "10"}], "}"}]}], ",", 
          RowBox[{"Frame", "\[Rule]", "True"}], ",", 
          RowBox[{"FrameLabel", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<t (ms)\>\"", ",", "20", ",", 
               RowBox[{"FontFamily", "\[Rule]", "\"\<Helvectica\>\""}]}], 
              "]"}], ",", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<|i| (pA)\>\"", ",", "20", ",", 
               RowBox[{"FontFamily", "\[Rule]", "\"\<Helvectica\>\""}]}], 
              "]"}]}], "}"}]}], ",", 
          RowBox[{"FrameTicksStyle", "\[Rule]", 
           RowBox[{"Directive", "[", 
            RowBox[{"20", ",", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Helvectica\>\""}]}], 
            "]"}]}]}], "]"}], "\[IndentingNewLine]", "}"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "600"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6094886083959637`*^9, 3.609488660383133*^9}, {
   3.609488768793646*^9, 3.609488820117818*^9}, {3.60948885320325*^9, 
   3.609488856403946*^9}, 3.609488896800836*^9, {3.609489157301141*^9, 
   3.6094891895826387`*^9}, 3.609489359201746*^9, {3.609691553302782*^9, 
   3.6096915713074903`*^9}, 3.609691744637438*^9, {3.610295320026568*^9, 
   3.610295326600246*^9}, {3.610396154994622*^9, 3.610396223097294*^9}, {
   3.610396256039795*^9, 3.610396294571361*^9}, {3.610396471373513*^9, 
   3.610396471572132*^9}, {3.610396517319343*^9, 3.6103966224428062`*^9}, {
   3.610438563783066*^9, 3.610438564142192*^9}, {3.610438693833914*^9, 
   3.610438731568367*^9}, {3.610438865866276*^9, 3.6104389404008017`*^9}, {
   3.610438983863574*^9, 3.6104391026730537`*^9}, {3.610439137656186*^9, 
   3.610439189105474*^9}, {3.6104392321691427`*^9, 3.610439273877078*^9}, {
   3.610439309969619*^9, 3.6104393124882717`*^9}, {3.6121334403351097`*^9, 
   3.612133441660656*^9}, {3.612133913555655*^9, 3.612133915876708*^9}, {
   3.612134068352976*^9, 3.6121340700620327`*^9}, {3.6121344233950377`*^9, 
   3.612134429227354*^9}, 3.6121346776863117`*^9, {3.6121347992310534`*^9, 
   3.612134800068111*^9}, {3.6144943490051327`*^9, 3.614494364153603*^9}, {
   3.614494488091107*^9, 3.614494488441135*^9}, {3.614494560520927*^9, 
   3.614494578334903*^9}, {3.61449466839638*^9, 3.614494672194643*^9}, {
   3.614494788882308*^9, 3.6144947925816507`*^9}, {3.614501350330645*^9, 
   3.614501352530095*^9}, 3.614501397908681*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"plotsra", "[", 
   RowBox[{"status_", ",", "ts_", ",", "md_", ",", "FsKHz_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "a", ",", "\[Mu]1", ",", "\[Mu]2", ",", "\[Tau]", ",", "b"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"Abs", "[", "ts", "]"}], ",", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"0", ",", "All"}], "}"}]}], ",", 
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"Directive", "[", 
             RowBox[{
              RowBox[{"RGBColor", "@@", 
               FractionBox[
                RowBox[{"{", 
                 RowBox[{"41", ",", " ", "74", ",", "130"}], "}"}], "255"]}], 
              ",", 
              RowBox[{"Opacity", "[", "0.75", "]"}]}], "]"}]}], ",", 
           RowBox[{"PlotMarkers", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Automatic", ",", "14"}], "}"}]}], ",", 
           RowBox[{"Frame", "\[Rule]", "True"}], ",", 
           RowBox[{"FrameLabel", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{"\"\<t (ms)\>\"", ",", "20", ",", 
                RowBox[{"FontFamily", "\[Rule]", "\"\<Helvectica\>\""}]}], 
               "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{"\"\<|i| (pA)\>\"", ",", "20", ",", 
                RowBox[{"FontFamily", "\[Rule]", "\"\<Helvectica\>\""}]}], 
               "]"}]}], "}"}]}], ",", 
           RowBox[{"FrameTicksStyle", "\[Rule]", 
            RowBox[{"Directive", "[", 
             RowBox[{"20", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Helvectica\>\""}]}], 
             "]"}]}], ",", 
           RowBox[{"Prolog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Thick", ",", "Dashed", ",", 
              RowBox[{"Darker", "[", "Red", "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                   "md", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], ",", 
                   RowBox[{"Abs", "[", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                   "md", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                   RowBox[{"Abs", "[", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "}"}], "]"}],
               ",", "\[IndentingNewLine]", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                   "md", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], ",", 
                   RowBox[{"Abs", "[", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                   "md", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], ",", 
                   RowBox[{"Abs", "[", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "}"}], "]"}],
               ",", "\[IndentingNewLine]", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                   "md", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                   RowBox[{"Abs", "[", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                   "md", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], ",", 
                   RowBox[{"Abs", "[", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "}"}], 
               "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"Evaluate", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"a", 
                    RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "1"}], "+", 
                    SuperscriptBox["\[ExponentialE]", 
                    FractionBox[
                    RowBox[{
                    RowBox[{"-", "t"}], "+", "\[Mu]1"}], "\[Tau]"]]}], ")"}], 
                    " ", 
                    RowBox[{"HeavisideTheta", "[", 
                    RowBox[{"t", "-", "\[Mu]1"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "-", 
                    SuperscriptBox["\[ExponentialE]", 
                    FractionBox[
                    RowBox[{
                    RowBox[{"-", "t"}], "+", "\[Mu]2"}], "\[Tau]"]]}], ")"}], 
                    " ", 
                    RowBox[{"HeavisideTheta", "[", 
                    RowBox[{"t", "-", "\[Mu]2"}], "]"}]}]}], ")"}]}], "+", 
                    "b"}], ")"}], "/.", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"a", "\[Rule]", 
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "-", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}], "]"}]}], ",", 
                    RowBox[{"b", "\[Rule]", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"\[Tau]", "\[Rule]", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "5", 
                    "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"\[Mu]1", "\[Rule]", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"\[Mu]2", "\[Rule]", 
                    RowBox[{
                    "md", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}]}]}], "}"}]}], "]"}]}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{
                 RowBox[{
                 "ts", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                  "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
                RowBox[{
                 RowBox[{"ts", "\[LeftDoubleBracket]", 
                  RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
                
                FractionBox[
                 RowBox[{"1", "/", "FsKHz"}], "10"]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", "}"}], ",", 
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Black", ",", 
                RowBox[{"Thickness", "[", "0.005", "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"Black", ",", 
                RowBox[{"Thickness", "[", "0.005", "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"Black", ",", 
                RowBox[{"Thickness", "[", "0.005", "]"}]}], "}"}]}], "}"}]}], 
           ",", 
           RowBox[{"Joined", "\[Rule]", "True"}]}], "]"}]}], 
        "\[IndentingNewLine]", "}"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "600"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}], "/;", 
   RowBox[{
   "status", "\[Equal]", "\"\<normal\>\""}]}]}], "\[IndentingNewLine]", 
 RowBox[{" ", 
  RowBox[{
   RowBox[{"plotsra", "[", 
    RowBox[{"status_", ",", "ts_", ",", "md_", ",", "FsKHz_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "a", ",", "\[Mu]1", ",", "\[Mu]2", ",", "\[Tau]", ",", "b"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"Abs", "[", "ts", "]"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", 
          RowBox[{"PlotMarkers", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"Automatic", ",", "10"}], "}"}]}], ",", 
          RowBox[{"Frame", "\[Rule]", "True"}], ",", 
          RowBox[{"FrameLabel", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<t (ms)\>\"", ",", "20", ",", 
               RowBox[{"FontFamily", "\[Rule]", "\"\<Helvectica\>\""}]}], 
              "]"}], ",", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<|i| (pA)\>\"", ",", "20", ",", 
               RowBox[{"FontFamily", "\[Rule]", "\"\<Helvectica\>\""}]}], 
              "]"}]}], "}"}]}], ",", 
          RowBox[{"FrameTicksStyle", "\[Rule]", 
           RowBox[{"Directive", "[", 
            RowBox[{"20", ",", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Helvectica\>\""}]}], 
            "]"}]}]}], "]"}], "\[IndentingNewLine]", "}"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "600"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6094886083959637`*^9, 3.609488660383133*^9}, {
   3.609488768793646*^9, 3.609488820117818*^9}, {3.60948885320325*^9, 
   3.609488856403946*^9}, 3.609488896800836*^9, {3.609489157301141*^9, 
   3.6094891895826387`*^9}, 3.609489359201746*^9, {3.609691553302782*^9, 
   3.6096915713074903`*^9}, 3.609691744637438*^9, {3.610295320026568*^9, 
   3.610295326600246*^9}, {3.610396154994622*^9, 3.610396223097294*^9}, {
   3.610396256039795*^9, 3.610396294571361*^9}, {3.610396471373513*^9, 
   3.610396471572132*^9}, {3.610396517319343*^9, 3.6103966224428062`*^9}, {
   3.610438563783066*^9, 3.610438564142192*^9}, {3.610438693833914*^9, 
   3.610438731568367*^9}, {3.610438865866276*^9, 3.6104389404008017`*^9}, {
   3.610438983863574*^9, 3.6104391026730537`*^9}, {3.610439137656186*^9, 
   3.610439189105474*^9}, {3.6104392321691427`*^9, 3.610439273877078*^9}, {
   3.610439309969619*^9, 3.6104393124882717`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"CaptureRate", "[", 
   RowBox[{"absstart_", ",", "stime_", ",", "etime_", ",", "nbins_"}], "]"}], 
  ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"at", "=", 
       RowBox[{"ArrivalTimes", "[", "absstart", "]"}]}], ",", "a", ",", 
      "\[Lambda]", ",", "t", ",", "ft", ",", "h1"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"h1", "=", 
      RowBox[{"Hist1D", "[", 
       RowBox[{"at", ",", 
        RowBox[{"{", 
         RowBox[{"stime", ",", "etime"}], "}"}], ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"etime", "-", "stime"}], ")"}], "/", "nbins"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"ft", "=", 
      RowBox[{"NonlinearModelFit", "[", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"h1", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
           FractionBox[
            RowBox[{"h1", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], 
            RowBox[{
             RowBox[{"h1", "\[LeftDoubleBracket]", 
              RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], 
             "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]]}], "}"}],
          "]"}], ",", 
        RowBox[{"a", " ", 
         RowBox[{"Exp", "[", 
          RowBox[{"-", 
           FractionBox["t", "\[Lambda]"]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"a", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"\[Lambda]", ",", 
            RowBox[{"Mean", "[", "at", "]"}]}], "}"}]}], "}"}], ",", "t"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           FractionBox["1", "\[Lambda]"], ",", 
           FractionBox["1", 
            RowBox[{"\[Lambda]", " ", 
             SqrtBox[
              RowBox[{"Length", "[", "at", "]"}]]}]]}], "}"}], "/.", 
         RowBox[{"ft", "[", "\"\<BestFitParameters\>\"", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Show", "[", 
         RowBox[{
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ListLogPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"h1", "\[LeftDoubleBracket]", 
                  RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                 FractionBox[
                  RowBox[{"h1", "\[LeftDoubleBracket]", 
                   RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], 
                  RowBox[{
                   RowBox[{"h1", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], 
                   "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]]}], 
                "}"}], "]"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"stime", ",", "etime"}], "}"}], ",", "All"}], 
                "}"}]}], ",", 
              RowBox[{"PlotMarkers", "\[Rule]", "Automatic"}], ",", 
              RowBox[{"Epilog", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"Text", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"NumberForm", "[", 
                    RowBox[{
                    FractionBox["1", "\[Lambda]"], ",", 
                    RowBox[{"{", 
                    RowBox[{"4", ",", "0"}], "}"}]}], "]"}], "\[PlusMinus]", 
                    RowBox[{"NumberForm", "[", 
                    RowBox[{
                    FractionBox["1", 
                    RowBox[{"\[Lambda]", 
                    SqrtBox[
                    RowBox[{"Length", "[", "at", "]"}]]}]], ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "1"}], "}"}]}], "]"}]}], "/.", 
                   RowBox[{"ft", "[", "\"\<BestFitParameters\>\"", "]"}]}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{
                    FractionBox[
                    RowBox[{"(", 
                    RowBox[{"etime", "-", "stime"}], ")"}], "2"], ",", 
                    RowBox[{"Log", "[", "0.5", "]"}]}], "}"}]}], "]"}], 
                "}"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"LogPlot", "[", 
             RowBox[{
              RowBox[{"Evaluate", "[", 
               RowBox[{"Normal", "[", "ft", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", "stime", ",", "etime"}], "}"}], ",", 
              RowBox[{"PlotStyle", "\[Rule]", "Thick"}]}], "]"}]}], 
           "\[IndentingNewLine]", "}"}], ",", 
          RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}]}], 
       "\[IndentingNewLine]", "}"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.604306479837874*^9, 3.604306542808179*^9}, {
  3.6043066025292053`*^9, 3.604306617636222*^9}, {3.604306676312483*^9, 
  3.6043066867286158`*^9}, {3.604306718077094*^9, 3.604306794809411*^9}, {
  3.60430703510187*^9, 3.6043071316312733`*^9}, {3.609487507962145*^9, 
  3.609487532233904*^9}, {3.609692970394767*^9, 3.6096929751150427`*^9}, {
  3.609693014128799*^9, 3.609693028391631*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ArrivalTimes", "[", 
   RowBox[{"dbname_", ",", " ", "query_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"q", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"QueryDB", "[", 
        RowBox[{
        "dbname", ",", " ", "\"\<AbsEventStart\>\"", ",", "\"\<normal\>\"", 
         ",", "query"}], "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"Differences", "/@", 
       RowBox[{"Partition", "[", 
        RowBox[{"q", ",", "2", ",", "1"}], "]"}]}], "]"}], "/", "1000"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.602508315683269*^9, 3.60250832230591*^9}, {
  3.6094872413531017`*^9, 3.609487325934058*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ArrivalTimes", "[", "arrtime_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Flatten", "[", 
    RowBox[{"Differences", "/@", 
     RowBox[{"Partition", "[", 
      RowBox[{"arrtime", ",", "2", ",", "1"}], "]"}]}], "]"}], "/", 
   "1000"}]}]], "Input",
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.602508315683269*^9, 3.60250832230591*^9}, {
  3.6094872413531017`*^9, 3.609487325934058*^9}, {3.609692891146203*^9, 
  3.609692906697002*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"kon", "[", 
   RowBox[{"cap_", ",", "c_"}], "]"}], ":=", 
  RowBox[{"1", "/", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "/", "cap"}], ")"}], "c"}], ")"}]}]}]], "Input",
 InitializationCell->True]
}, Open  ]]
},
NotebookEventActions->None,
WindowSize->{1043, 673},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"9.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (January 25, \
2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 144, 3, 28, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[726, 27, 107, 1, 35, "Subsubsection"],
Cell[836, 30, 773, 14, 284, "Input",
 InitializationCell->True],
Cell[1612, 46, 834, 16, 114, "Input",
 InitializationCell->True],
Cell[2449, 64, 702, 17, 63, "Input",
 InitializationCell->True],
Cell[3154, 83, 2875, 51, 709, "Input",
 InitializationCell->True],
Cell[6032, 136, 1897, 36, 97, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[7966, 177, 103, 1, 35, "Subsubsection"],
Cell[8072, 180, 886, 23, 97, "Input",
 InitializationCell->True],
Cell[8961, 205, 4164, 104, 250, "Input",
 InitializationCell->True],
Cell[13128, 311, 457, 12, 28, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[13610, 327, 316, 8, 28, "Input"],
Cell[13929, 337, 420, 8, 46, "Output"]
}, Open  ]],
Cell[14364, 348, 460, 14, 49, "Input",
 InitializationCell->True],
Cell[14827, 364, 6587, 141, 386, "Input",
 InitializationCell->True],
Cell[21417, 507, 2209, 62, 97, "Input"],
Cell[23629, 571, 11191, 247, 615, "Input",
 InitializationCell->True],
Cell[34823, 820, 11767, 271, 546, "Input",
 InitializationCell->True],
Cell[46593, 1093, 5643, 135, 431, "Input",
 InitializationCell->True],
Cell[52239, 1230, 805, 21, 63, "Input",
 InitializationCell->True],
Cell[53047, 1253, 499, 13, 28, "Input",
 InitializationCell->True,
 InitializationGroup->True],
Cell[53549, 1268, 257, 9, 28, "Input",
 InitializationCell->True]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
